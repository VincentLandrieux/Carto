(()=>{var L=Object.defineProperty;var I=(t,e,i)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var W=typeof require!="undefined"?require:t=>{throw new Error('Dynamic require of "'+t+'" is not supported')};var h=(t,e,i)=>(I(t,typeof e!="symbol"?e+"":e,i),i);var d=class{constructor(e,i,r,l){this.x=e,this.y=i,this.longitude=r,this.latitude=l}static draw(e,i,r){e.drawImage(d.img,i-d.width/2,r-d.height,d.width,d.height)}},c=d;h(c,"width",40),h(c,"height",40),h(c,"img",new Image),h(c,"imgInit",(()=>(d.img.src="./images/placemark.png",!0))());var u=class extends c{orientation=0;static draw(e,i,r,l=0){e.save(),e.translate(i,r),e.rotate(l*Math.PI/180),e.drawImage(u.img,-u.width/2,-u.height/2,u.width,u.height),e.restore()}},w=u;h(w,"img",new Image),h(w,"_imgInit",(()=>(u.img.src="./images/user_placemark.png",!0))());var p=class{stepX=(2.9901-2.9739)/(1065-688);stepY=(43.6036-43.6001)/(790-904);startX=2.9901/this.stepX-1065;startY=43.6036/this.stepY-790;viewX=0;viewY=0;constructor(e,i,r,l){this.width=e,this.height=i,this.viewWidth=r,this.viewHeight=l}move(e,i){this.viewX-=e,this.viewY-=i;let r=this.width-this.viewWidth,l=this.height-this.viewHeight;-this.viewX<0&&(this.viewX=0),-this.viewY<0&&(this.viewY=0),-this.viewX>r&&(this.viewX=-r),-this.viewY>l&&(this.viewY=-l)}longitudeToX(e){return e/this.stepX-this.startX}latitudeToY(e){return e/this.stepY-this.startY}gpsToPx(e,i){return{x:this.longitudeToX(e),y:this.latitudeToY(i)}}pxToGps(e,i){return{longitude:Math.trunc((e+this.startX)*this.stepX*1e3)/1e3,latitude:Math.trunc((i+this.startY)*this.stepY*1e3)/1e3}}};var m=class{tileXStart=16652;tileYStart=11962;tileXEnd=16659;tileYEnd=11969;tileMatrix=15;tileSize=256;tiles=[]};h(m,"urlTiles","https://wxs.ign.fr/an7nvfzojv5wa96dsga5nk8w/geoportail/wmts?layer=GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN25TOUR.CV&style=normal&tilematrixset=PM&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fjpeg");var T=()=>{let t,e=document.querySelector(".add-button");e.style.display="none",window.addEventListener("beforeinstallprompt",i=>{i.preventDefault(),t=i,e.style.display="block",e.addEventListener("click",r=>{e.style.display="none",t.prompt(),t.userChoice.then(l=>{l.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),t=null})})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js")};T();var s=document.querySelector(".map"),g=s.getContext?s.getContext("2d"):null,Y=null,X=null,f=null,x=document.querySelector(".loc-button"),o=new m,a=new p((o.tileXEnd-o.tileXStart)*o.tileSize,(o.tileYEnd-o.tileYStart)*o.tileSize,s.width,s.height),b=[v(2.9901,43.6036),v(2.9739,43.6001),v(2.9822,43.606),v(2.9737,43.6104),v(2.9556,43.5995)],n=null;function z(t){let e=new Image;return e.src=t,e}function v(t,e){return new c(a.longitudeToX(t),a.latitudeToY(e),t,e)}function C(t,e){return new w(a.longitudeToX(t),a.latitudeToY(e),t,e)}function H(t,e){n?(n.x=a.longitudeToX(t),n.y=a.latitudeToY(e),n.longitude=t,n.latitude=e):console.error("placemarkUser is null")}function y(t){let e=Y-t.offsetX,i=X-t.offsetY;a.move(e,i),Y=t.offsetX,X=t.offsetY}function E(){s.width=s.clientWidth,s.height=s.clientHeight,a.viewWidth=s.width,a.viewHeight=s.height}function R(t){let e=o.tileSize*t.x+a.viewX,i=o.tileSize*t.y+a.viewY;e>-o.tileSize&&i>-o.tileSize&&e<s.width+o.tileSize&&i<s.height+o.tileSize&&g.drawImage(t.img,e,i)}function M(){requestAnimationFrame(M),g.clearRect(0,0,s.width,s.height),g.fillStyle="rgba(200,200,200)",g.fillRect(0,0,s.width,s.height),o.tiles.forEach(t=>{R(t)}),b.forEach(t=>{c.draw(g,t.x+a.viewX,t.y+a.viewY)}),n&&w.draw(g,n.x+a.viewX,n.y+a.viewY)}function j(t){n.longitude!=t.coords.longitude&&n.latitude!=t.coords.latitude&&(H(t.coords.longitude,t.coords.latitude),(n.x<0||n.x>a.width||n.y<0||n.y>a.height)&&(alert("Localisation hors de la carte"),n=null,S())),t.coords.heading&&(n.orientation=t.coords.heading)}function k(t){alert(t.message),S()}function S(){f&&(navigator.geolocation.clearWatch(f),f=null),x.innerHTML="Localisation"}window.addEventListener("resize",E);s.addEventListener("mousedown",t=>{Y=t.offsetX,X=t.offsetY,s.addEventListener("mousemove",y)});document.addEventListener("mouseup",()=>{s.removeEventListener("mousemove",y)});s.addEventListener("touchstart",t=>{let e=t.target.getBoundingClientRect();Y=t.targetTouches[0].clientX-e.x,X=t.targetTouches[0].clientY-e.y});s.addEventListener("touchmove",t=>{t.preventDefault();let e=t.target.getBoundingClientRect();t.offsetX=t.targetTouches[0].clientX-e.x,t.offsetY=t.targetTouches[0].clientY-e.y,y(t)});x.addEventListener("click",()=>{f?S():(x.innerHTML="D\xE9sactiver",n||(n=C(null,null)),f=navigator.geolocation.watchPosition(j,k))});g?(E(),M()):console.error("canvas non compatible avec ce navigateur");for(let t=o.tileYStart;t<o.tileYEnd;t++)for(let e=o.tileXStart;e<o.tileXEnd;e++)o.tiles.push({x:e-o.tileXStart,y:t-o.tileYStart,img:z(`${m.urlTiles}&TileMatrix=${o.tileMatrix}&TileCol=${e}&TileRow=${t}`)});"geolocation"in navigator||(x.style.display="none",console.error("la g\xE9olocalisation n'est pas disponible"));})();
//# sourceMappingURL=script.js.map
