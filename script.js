(()=>{var I=Object.defineProperty;var L=(e,t,i)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var A=typeof require!="undefined"?require:e=>{throw new Error('Dynamic require of "'+e+'" is not supported')};var h=(e,t,i)=>(L(e,typeof t!="symbol"?t+"":t,i),i);var d=class{constructor(t,i,r,l){this.x=t,this.y=i,this.longitude=r,this.latitude=l}static draw(t,i,r){t.drawImage(d.img,i-d.width/2,r-d.height,d.width,d.height)}},c=d;h(c,"width",40),h(c,"height",40),h(c,"img",new Image),h(c,"imgInit",(()=>(d.img.src="./images/placemark.png",!0))());var u=class extends c{orientation=0;static draw(t,i,r,l=0){t.save(),t.translate(i,r),t.rotate(l*Math.PI/180),t.drawImage(u.img,-u.width/2,-u.height/2,u.width,u.height),t.restore()}},w=u;h(w,"img",new Image),h(w,"_imgInit",(()=>(u.img.src="./images/user_placemark.png",!0))());var v=class{stepX=(2.9901-2.9739)/(1065-688);stepY=(43.6036-43.6001)/(790-904);startX=2.9901/this.stepX-1065;startY=43.6036/this.stepY-790;viewX=0;viewY=0;constructor(t,i,r,l){this.width=t,this.height=i,this.viewWidth=r,this.viewHeight=l}move(t,i){this.viewX-=t,this.viewY-=i;let r=this.width-this.viewWidth,l=this.height-this.viewHeight;-this.viewX<0&&(this.viewX=0),-this.viewY<0&&(this.viewY=0),-this.viewX>r&&(this.viewX=-r),-this.viewY>l&&(this.viewY=-l)}longitudeToX(t){return t/this.stepX-this.startX}latitudeToY(t){return t/this.stepY-this.startY}gpsToPx(t,i){return{x:this.longitudeToX(t),y:this.latitudeToY(i)}}pxToGps(t,i){return{longitude:Math.trunc((t+this.startX)*this.stepX*1e3)/1e3,latitude:Math.trunc((i+this.startY)*this.stepY*1e3)/1e3}}};var m=class{tileXStart=16652;tileYStart=11962;tileXEnd=16659;tileYEnd=11969;tileMatrix=15;tileSize=256;tiles=[]};h(m,"urlTiles","https://wxs.ign.fr/an7nvfzojv5wa96dsga5nk8w/geoportail/wmts?layer=GEOGRAPHICALGRIDSYSTEMS.MAPS.SCAN25TOUR.CV&style=normal&tilematrixset=PM&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fjpeg");var y=()=>{let e,t=document.querySelector(".add-button");t.style.display="none",window.addEventListener("beforeinstallprompt",i=>{i.preventDefault(),e=i,t.style.display="block",t.addEventListener("click",r=>{t.style.display="none",e.prompt(),e.userChoice.then(l=>{l.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),e=null})})}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js")};y();var o=document.querySelector(".map"),g=o.getContext?o.getContext("2d"):null,X=null,S=null,f=null,Y=document.querySelector(".loc-button"),s=new m,a=new v((s.tileXEnd-s.tileXStart)*s.tileSize,(s.tileYEnd-s.tileYStart)*s.tileSize,o.width,o.height),z=[p(2.9901,43.6036),p(2.9739,43.6001),p(2.9822,43.606),p(2.9737,43.6104),p(2.9556,43.5995)],n=null;function b(e){let t=new Image;return t.src=e,t}function p(e,t){return new c(a.longitudeToX(e),a.latitudeToY(t),e,t)}function C(e,t){return new w(a.longitudeToX(e),a.latitudeToY(t),e,t)}function H(e,t){n?(n.x=a.longitudeToX(e),n.y=a.latitudeToY(t),n.longitude=e,n.latitude=t):console.error("placemarkUser is null")}function T(e){let t=X-e.offsetX,i=S-e.offsetY;a.move(t,i),X=e.offsetX,S=e.offsetY}function E(){o.width=o.clientWidth,o.height=o.clientHeight,a.viewWidth=o.width,a.viewHeight=o.height}function j(e){let t=s.tileSize*e.x+a.viewX,i=s.tileSize*e.y+a.viewY;t>-s.tileSize&&i>-s.tileSize&&t<o.width+s.tileSize&&i<o.height+s.tileSize&&g.drawImage(e.img,t,i)}function M(){requestAnimationFrame(M),g.clearRect(0,0,o.width,o.height),g.fillStyle="rgba(200,200,200)",g.fillRect(0,0,o.width,o.height),s.tiles.forEach(e=>{j(e)}),z.forEach(e=>{c.draw(g,e.x+a.viewX,e.y+a.viewY)}),n&&w.draw(g,n.x+a.viewX,n.y+a.viewY)}function k(e){n.longitude!=e.coords.longitude&&n.latitude!=e.coords.latitude&&(H(e.coords.longitude,e.coords.latitude),(n.x<0||n.x>a.width||n.y<0||n.y>a.height)&&(alert("Localisation hors de la carte"),n=null,x())),e.coords.heading&&(n.orientation=e.coords.heading)}function W(e){alert(e.message),x()}function x(){f&&(navigator.geolocation.clearWatch(f),f=null),Y.innerHTML="Localisation"}window.addEventListener("resize",E);o.addEventListener("mousedown",e=>{X=e.offsetX,S=e.offsetY,o.addEventListener("mousemove",T)});document.addEventListener("mouseup",()=>{o.removeEventListener("mousemove",T)});Y.addEventListener("click",()=>{f?x():(Y.innerHTML="D\xE9sactiver",n||(n=C(null,null)),f=navigator.geolocation.watchPosition(k,W))});g?(E(),M()):console.error("canvas non compatible avec ce navigateur");for(let e=s.tileYStart;e<s.tileYEnd;e++)for(let t=s.tileXStart;t<s.tileXEnd;t++)s.tiles.push({x:t-s.tileXStart,y:e-s.tileYStart,img:b(`${m.urlTiles}&TileMatrix=${s.tileMatrix}&TileCol=${t}&TileRow=${e}`)});"geolocation"in navigator||(Y.style.display="none",console.error("la g\xE9olocalisation n'est pas disponible"));})();
//# sourceMappingURL=script.js.map
